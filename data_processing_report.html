<!DOCTYPE html>
<html>
<head>
    <title>Data Processing Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        .metric { background-color: #f2f2f2; padding: 10px; margin: 10px 0; }
        .warning { color: #ff9800; }
        .error { color: #f44336; }
        .success { color: #4CAF50; }
    </style>
</head>
<body>
    <h1>Data Processing Report</h1>
    
    <div class="metric">
        <h2>Processing Summary</h2>
        <p><strong>Input File:</strong> {{ input_file }}</p>
        <p><strong>Output Path:</strong> {{ output_path }}</p>
        <p><strong>Rows Processed:</strong> {{ clean_data.row_count }}</p>
        <p><strong>Quality Score:</strong> 
            <span class="{% if quality_check.result.quality_score >= quality_threshold %}success{% else %}warning{% endif %}">
                {{ quality_check.result.quality_score | round(2) }}
            </span>
        </p>
    </div>
    
    <h2>Data Quality Issues</h2>
    <ul>
    {% for issue in quality_check.result.issues_found %}
        <li class="warning">{{ issue }}</li>
    {% endfor %}
    </ul>
    
    <h2>Monthly Revenue Trends</h2>
    <table>
        <tr>
            <th>Month</th>
            <th>Total Revenue</th>
            <th>Order Count</th>
            <th>Unique Customers</th>
        </tr>
        {% for row in aggregate_monthly.result %}
        <tr>
            <td>{{ row.order_month }}</td>
            <td>${{ row.total_revenue | round(2) }}</td>
            <td>{{ row.order_count }}</td>
            <td>{{ row.unique_customers }}</td>
        </tr>
        {% endfor %}
    </table>
    
    <h2>Top Products</h2>
    <ol>
    {% for product in analyze_trends.result.top_products %}
        <li>{{ product.product }} - ${{ product.revenue | round(2) }}</li>
    {% endfor %}
    </ol>
    
    <h2>Order Status Distribution</h2>
    <table>
        <tr>
            <th>Product</th>
            {% for status in ['pending', 'processing', 'shipped', 'delivered'] %}
            <th>{{ status | title }}</th>
            {% endfor %}
        </tr>
        {% for row in pivot_analysis.result %}
        <tr>
            <td>{{ row.product_name }}</td>
            {% for status in ['pending', 'processing', 'shipped', 'delivered'] %}
            <td>{{ row[status] or 0 }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
    
    <h2>Recommendations</h2>
    <ul>
    {% for rec in quality_check.result.recommendations %}
        <li>{{ rec }}</li>
    {% endfor %}
    </ul>
    
    <hr>
    <p><em>Report generated on {{ current_date }}</em></p>
</body>
</html>
