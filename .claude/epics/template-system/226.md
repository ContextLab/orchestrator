---
name: Template resolution system needs comprehensive fixes
status: completed
created: 2025-08-21T21:16:37Z
updated: 2025-08-22T12:24:28Z
github: https://github.com/ContextLab/orchestrator/issues/226
imported: true
labels: bug, high-priority, architecture
---

# Template resolution system needs comprehensive fixes

**GitHub Issue:** [#223](https://github.com/ContextLab/orchestrator/issues/223)
**Status:** OPEN
**Labels:** bug, high-priority, architecture

## Description

## Overview
Multiple related issues prevent templates from working correctly across the orchestrator, particularly affecting loops, filesystem operations, and structured data handling.

## Related Issues
- #219: While loop variables ($iteration) not available in templates
- #220: Filesystem tool not resolving template variables  
- #222: Generate-structured returns strings instead of structured data

## Core Problem
The template resolution system is not consistently applied across:
1. **Loop contexts**: Loop variables not injected into template context
2. **Tool parameters**: Templates in paths and content not resolved before tool execution
3. **Action outputs**: Structured data not properly exposed to template engine

## Impact
This affects multiple pipelines including:
- iterative_fact_checker.yaml (Issue #172)
- Any pipeline using while/for loops with dynamic file names
- Pipelines relying on structured data extraction

## Proposed Solution
Need a unified template resolution layer that:
1. Collects all context variables (parameters, loop vars, step results)
2. Resolves templates BEFORE passing to tools
3. Properly exposes structured data to template engine
4. Works consistently across all components

## Test Coverage Needed
- While loop iteration variables
- For-each loop item variables
- Nested data structure access
- Dynamic file paths
- Template resolution in tool parameters
- Structured data field access

## Priority
High - This blocks several pipeline implementations and affects core functionality