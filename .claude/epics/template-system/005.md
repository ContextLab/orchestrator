---
name: Critical: Template rendering fails in multiple contexts causing poor output quality
status: active
created: 2025-07-31T03:10:38Z
updated: 2025-08-14T23:19:16Z
github: https://github.com/ContextLab/orchestrator/issues/183
imported: true
labels: bug
---

# Critical: Template rendering fails in multiple contexts causing poor output quality

**GitHub Issue:** [#183](https://github.com/ContextLab/orchestrator/issues/183)
**Status:** OPEN
**Labels:** bug

## Description

## Problem Summary

Template rendering is fundamentally broken in several contexts, causing pipelines to produce low-quality outputs with unrendered placeholders and generic AI responses.

## Specific Issues

### 1. Unrendered Template Variables
- Files contain literal `{{input_text}}`, `{{output}}`, etc. instead of actual values
- Pipeline parameters are not accessible in all contexts where they should be

### 2. AI Models Receive Template Strings
- Tasks receive raw Jinja2 templates like `{% if enhance_text.result %}...` instead of rendered content
- This causes models to respond with confusion ("Please provide the text...")

### 3. Context Not Properly Built
- Pipeline parameters (input_text, output, etc.) not available in task execution context
- Previous task results not accessible within for_each loops
- Template context inconsistently built across different control systems

## Affected Pipelines
- control_flow_advanced.yaml (severely affected)
- Likely affects all pipelines using complex templates

## Example Failures

### enhance_text task receives:
```
Improve the following text based on this analysis:
Analysis: {{ analyze_text.result }}

Text: {{ input_text }}
```

Instead of:
```
Improve the following text based on this analysis:
Analysis: [actual analysis content]

Text: Renewable energy transforms electricity generation worldwide
```

### Translation outputs contain:
```
Original Text: Sure\! Please provide the analysis and the text you'd like me to improve.
```

## Root Causes
1. ModelBasedControlSystem only renders templates for specific cases
2. HybridControlSystem doesn't consistently apply template rendering
3. Loop execution creates isolated contexts without access to pipeline parameters
4. Template rendering happens at wrong stages of execution

## Impact
- Poor quality outputs that are unusable
- Pipelines appear to work but produce garbage
- Users get confused by placeholder text in outputs

## Priority
**Critical** - This affects core functionality and makes many pipelines unusable despite appearing to run successfully.