id: research_minimal
name: Minimal Research Pipeline
description: Simplest possible research - just search and summarize (requires only web-search tool)
version: "1.0.0"

parameters:
  topic:
    type: string
    required: true
    description: The research topic

steps:
  - id: search_web
    tool: web-search
    action: search
    parameters:
      query: "{{topic}}"
      max_results: 5
  
  - id: summarize_results
    action: generate_text
    parameters:
      prompt: |
        Analyze these search results about {{topic}} and provide a structured response:
        
        {% for result in search_web.results %}
        {{loop.index}}. {{result.title}}
           {{result.snippet}}
           Source: {{result.url}}
        {% endfor %}
        
        Return a JSON object with the following structure:
        {
          "topic": "{{topic}}",
          "overview": "Brief one-sentence overview",
          "key_points": [
            "First main point (1-2 sentences)",
            "Second main point (1-2 sentences)",
            "Third main point (1-2 sentences)"
          ],
          "summary": "Concise 2-3 sentence summary of the main findings"
        }
        
        Ensure the response is valid JSON and contains only factual information from the sources.
      model: <AUTO task="summarize">Select appropriate model for summarization</AUTO>
      max_tokens: 500
      response_format: "json_object"
    dependencies:
      - search_web
  
  - id: format_report
    action: generate_text
    parameters:
      prompt: |
        Parse the JSON data below and create a clean markdown research report. Use ONLY the provided data - do not add any placeholder text.
        
        TOPIC: {{topic}}
        DATE: {{ execution.timestamp | date('%Y-%m-%d %H:%M:%S') }}
        SOURCES COUNT: {{search_web.total_results}}
        
        JSON DATA TO PARSE:
        {{summarize_results.result}}
        
        ACTUAL SOURCE LINKS:
        {% for result in search_web.results %}
        {{loop.index}}. {{result.title}} - {{result.url}}
        {% endfor %}
        
        Create a markdown report using this EXACT format and the actual data above:
        
        # Research Summary: {{topic}}
        **Date:** {{ execution.timestamp | date('%Y-%m-%d %H:%M:%S') }}
        **Sources Reviewed:** {{search_web.total_results}} sources reviewed
        
        ## Overview
        [Extract the "overview" value from the JSON data]
        
        ## Key Findings
        [Extract each item from "key_points" array in the JSON and number them 1, 2, 3, etc.]
        
        ## Summary
        [Extract the "summary" value from the JSON data]
        
        ## Sources
        [Use the actual source links listed above, formatted as: 1. [title](url)]
        
        ---
        *Generated by Simple Research Pipeline*
        
        IMPORTANT: Use the actual data provided above. Do not use placeholder URLs or dates.
      model: <AUTO task="generate">Select model for formatting</AUTO>
      max_tokens: 1000
    dependencies:
      - summarize_results
  
  - id: save_summary
    tool: filesystem
    action: write
    parameters:
      path: "examples/outputs/research_minimal/{{topic | slugify}}_summary.md"
      content: "{{format_report.result}}"
    dependencies:
      - format_report

outputs:
  summary: "{{summarize_results.result}}"
  search_count: "{{search_web.total_results}}"
  output_file: "{{save_summary.filepath}}"
  formatted_report: "{{format_report.result}}"