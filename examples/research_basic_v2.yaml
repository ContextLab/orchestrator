id: research_basic_v2
name: Enhanced Basic Research Pipeline
description: Generate high-quality research reports with better prompts and source filtering
version: "2.0.0"

parameters:
  topic:
    type: string
    required: true
    description: Research topic
  depth:
    type: string
    default: comprehensive
    description: Research depth (basic, comprehensive, or expert)

steps:
  - id: initial_search
    tool: web-search
    action: search
    parameters:
      query: "{{topic}} overview introduction basics"
      max_results: 20  # Get more results to filter from
  
  - id: deep_search
    tool: web-search
    action: search
    parameters:
      query: "{{topic}} advanced research latest developments 2024 2025"
      max_results: 20  # Get more results to filter from
    dependencies:
      - initial_search
  
  - id: filter_sources
    action: analyze_text
    parameters:
      text: |
        Analyze these search results and select the most relevant and high-quality sources for a research report on "{{topic}}".
        
        Initial search results:
        {% for result in initial_search.results %}
        {{loop.index}}. {{result.title}} ({{result.url}})
           Snippet: {{result.snippet}}
        {% endfor %}
        
        Deep search results:
        {% for result in deep_search.results %}
        {{loop.index}}. {{result.title}} ({{result.url}})
           Snippet: {{result.snippet}}
        {% endfor %}
      prompt: |
        You are a research quality analyst. Filter the search results above and identify the top 8-10 most relevant and credible sources.
        
        Criteria for selection:
        - Relevance to {{topic}}
        - Source credibility (prefer .edu, .gov, established organizations, peer-reviewed content)
        - Recency (prefer recent content, especially for rapidly evolving topics)
        - Content quality (avoid content farms, low-quality sites, or overly promotional material)
        - Diversity of perspectives
        
        Format your response as follows:
        
        SELECTED SOURCES:
        1. [Title] - URL
           Reason: [Why selected]
        
        2. [Title] - URL
           Reason: [Why selected]
        
        [Continue for all selected sources]
        
        QUALITY ASSESSMENT:
        [Brief overall assessment of source quality and coverage]
      model: <AUTO task="analyze">Select model for source filtering</AUTO>
    dependencies:
      - initial_search
      - deep_search
  
  - id: extract_key_points
    action: analyze_text
    parameters:
      text: |
        Topic: {{topic}}
        
        Source quality assessment:
        {{filter_sources.result}}
        
        All search snippets for detailed analysis:
        {% for result in initial_search.results %}
        - {{result.snippet}}
        {% endfor %}
        {% for result in deep_search.results %}
        - {{result.snippet}}
        {% endfor %}
      prompt: |
        You are an expert research analyst. Extract and synthesize the key points about {{topic}} from the search results above.
        
        Your task:
        1. Identify the most important facts, concepts, and developments
        2. Organize information thematically
        3. Note any conflicting information or debates
        4. Highlight recent developments or breakthroughs
        5. Include specific examples, statistics, or case studies when mentioned
        
        Format your response as a structured analysis with clear sections and bullet points.
        Do NOT use conversational language or phrases like "Certainly!" or "I'd be happy to help."
        Write in a direct, academic style suitable for a research report.
      model: <AUTO task="analyze">Select model for information extraction</AUTO>
      analysis_type: "key_points"
    dependencies:
      - filter_sources
  
  - id: generate_summary
    action: generate_text
    parameters:
      prompt: |
        Task: Write an executive summary for a {{depth}} research report on "{{topic}}" using these key findings:
        
        {{extract_key_points.result}}
        
        Requirements:
        - Length: 250-400 words
        - Style: Professional, direct, and informative
        - Structure: Opening statement, 3-4 main points, closing insight
        - Do NOT use conversational phrases or filler text
        - Do NOT ask for more information or say things like "Certainly!" or "I'd be happy to"
        - Focus on the most significant findings and their implications
        - Include specific details, numbers, or examples where available
        - Start directly with the content, no meta-commentary
        
        Begin the executive summary immediately:
      model: <AUTO task="generate">Select model for summary generation</AUTO>
      max_tokens: 500
    dependencies:
      - extract_key_points
  
  - id: generate_analysis
    action: generate_text
    parameters:
      prompt: |
        Provide a {{depth}} analysis of {{topic}} based on these findings:
        
        {{extract_key_points.result}}
        
        Structure your analysis with these sections:
        1. Current State and Trends
        2. Key Challenges and Opportunities  
        3. Future Directions and Implications
        4. Critical Evaluation
        
        Requirements:
        - Use specific examples and evidence from the findings
        - Identify patterns and connections between different aspects
        - Provide balanced perspective on controversies or debates
        - Make concrete predictions or recommendations where appropriate
        - Write in analytical, academic style
        - Avoid generic statements or filler content
        
        Depth level "{{depth}}" means:
        - basic: Focus on fundamental concepts and major trends
        - comprehensive: Include detailed analysis and multiple perspectives
        - expert: Deep dive with technical details and nuanced insights
      model: <AUTO task="analyze">Select model for analysis</AUTO>
      max_tokens: 1500
    dependencies:
      - extract_key_points
  
  - id: generate_conclusion
    action: generate_text
    parameters:
      prompt: |
        Write a compelling conclusion for the research report on {{topic}} that synthesizes these elements:
        
        Executive Summary:
        {{generate_summary.result}}
        
        Key Analysis Points:
        {{generate_analysis.result}}
        
        Requirements:
        - Synthesize the most important findings into 2-3 key takeaways
        - Highlight surprising or particularly significant insights
        - Discuss broader implications for the field
        - Suggest areas for future research or action
        - End with a forward-looking statement
        - Length: 150-250 words
        - Avoid clich√©s like "This research examined X through web sources"
        - Make it substantive and specific to {{topic}}
        - Start directly with the conclusion content
      model: <AUTO task="generate">Select model for conclusion writing</AUTO>
      max_tokens: 300
    dependencies:
      - generate_summary
      - generate_analysis
  
  - id: save_report
    tool: filesystem
    action: write
    parameters:
      path: "examples/outputs/research_basic_v2/research_{{topic | slugify}}.md"
      content: |
        # Research Report: {{topic}}
        
        **Date:** {{ execution.timestamp | date('%Y-%m-%d %H:%M:%S') }}
        **Research Depth:** {{depth}}
        **Sources Analyzed:** High-quality sources selected from {{initial_search.total_results + deep_search.total_results}} total search results
        
        ## Executive Summary
        
        {{generate_summary.result}}
        
        ## Introduction
        
        This {{depth}}-level analysis examines {{topic}} through a curated selection of high-quality sources, focusing on current understanding, recent developments, and future implications.
        
        ## Key Findings
        
        {{extract_key_points.result}}
        
        ## Analysis
        
        {{generate_analysis.result}}
        
        ## Source Quality and Selection
        
        {{filter_sources.result}}
        
        ## Conclusion
        
        {{generate_conclusion.result}}
        
        ---
        *Report generated by Orchestrator Research Pipeline v2.0*
    dependencies:
      - generate_conclusion
      - filter_sources

outputs:
  report_file: "{{save_report.filepath}}"
  total_sources_analyzed: "{{initial_search.total_results + deep_search.total_results}}"
  key_findings: "{{extract_key_points.result}}"